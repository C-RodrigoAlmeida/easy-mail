{% extends 'base.html' %}
{% load render_email_fields %}
{% load numeric_tags %}

{% block content %}
<div class="m-5 rounded-lg">
    <h1 class="text-3xl text-white mb-5">Send an E-mail</h1>
    <form action="{% url 'inbox:email_send' %}" method="GET">
        
        <!-- To Section -->
        <div id="to_method" class="mb-5">
            <p class="text-white">To:</p>
            {% render_email_field request.GET.to_method 'to' recipients groups request.GET.to %}
        </div>

        <!-- CC Section -->
        <div id="cc_method" class="mb-5">
            <p class="text-white">CC:</p>
            {% render_email_field request.GET.cc_method 'cc' recipients groups request.GET.cc %}
        </div>

        <!-- CCO Section -->
        <div id="cco_method" class="mb-5">
            <p class="text-white">CCO:</p>
            {% render_email_field request.GET.cco_method 'cco' recipients groups request.GET.cco %}
        </div>

        <div id="content_method" class="mb-5">
            <p class="text-white">Email Content: </p>
            <div class="flex gap-3 mb-5">
                <select 
                    name="content_method" 
                    class="block basis-1/5 p-2.5 border border-gray-300 rounded-lg bg-gray-700 border-gray-600 text-white"
                    onchange="this.form.submit()"
                >
                    <option {% if request.GET.content_method == 'manual' or not request.GET.to_method %} selected {% endif %} value="manual">
                        Manual
                    </option>
                    <option {% if request.GET.content_method == 'template' %} selected {% endif %} value="template">Message Template</option>
        
                </select>

                {% if request.GET.content_method == 'template' %}
                    <select 
                        name="template_subject" 
                        class="block basis-4/5 p-2.5 border border-gray-300 rounded-lg bg-gray-700 border-gray-600 text-white"
                        onchange="this.form.submit()"
                    >
                    <option selected disabled value="0">Select an option</option>
                        {% for template in templates %}
                            <option {% if template.pk == request.GET.template_subject|to_int %} selected {% endif %} value="{{ template.pk }}">{{ template }}</option>
                        {% endfor %}
                    </select> 

                {% else %}
                    <input
                        type="text"
                        name="subject"
                        class="block basis-4/5 p-2.5 border border-gray-300 rounded-lg bg-gray-700 border-gray-600 text-white"
                        value="{{ request.GET.subject }}"
                        placeholder="{% if request.GET.subject %}{{ request.GET.subject }}{% else %}Subject{% endif %}"
                    >
                {% endif %}
            </div>

            <textarea
                name="content"
                class="block p-2.5 w-full border border-gray-300 rounded-lg bg-gray-700 border-gray-600 text-white"
            >
                {% if request.GET.content_method == 'template' %}
                    {{ content|safe }}
                {% else %}
                    {{ request.GET.content|safe }}
                {% endif %}
            </textarea>
        </div>
    </form>
</div>          
{% endblock %}
